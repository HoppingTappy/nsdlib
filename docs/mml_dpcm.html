<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<meta name="GENERATOR" content="Microsoft&reg; HTML Help Workshop 4.1">
<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
<meta http-equiv='Content-Style-Type' content='text/css'>
<link rel="stylesheet" type="text/css" href="help.css">
<Title>MML reference: Delta PCM define block</Title>
</HEAD>
<BODY>

<!-- header start -->
<div id='header'>
<h1>NSDL（NES Sound Driver Library）</h1>
<a href="index.html">トップ</a>＼
<a href="usage.html">使い方</a>＼
<a href="usage_nsc.html">MMLコンパイラ</a>＼
<a href="mml.html">MML文法</a>＼
</div>

<!-- contents start -->
<div id='contents'>
<h2>MML reference: Delta PCM define block</h2>

<!-- ──────────────── -->
<div class='block'>
<h3>定義（Define）</h3>
<code><pre>
DPCM{
	n<var>number</var>,"<var>filename</var>",<var>rate</var>,<var>mode</var><span style="color:blue;">(</span>,<var>volume</var><span style="color:blue;">)(</span>,<var>next</var><span style="color:blue;">)(</span>,<var>offset</var><span style="color:blue;">)(</span>,<var>size</var><span style="color:blue;">)</span>
	<var>note</var><span style="color:blue;">(</span><var>Accidentals</var><span style="color:blue;">)</span><var>octave</var>,"<var>filename</var>",<var>mode</var><span style="color:blue;">(</span>,<var>volume</var><span style="color:blue;">)(</span>,<var>next</var><span style="color:blue;">)(</span>,<var>offset</var><span style="color:blue;">)(</span>,<var>size</var><span style="color:blue;">)</span>
}
</pre></code>
<code><pre>
@DPCM{
	n<var>number</var>,"<var>filename</var>",<var>rate</var>,<var>mode</var><span style="color:blue;">(</span>,<var>volume</var><span style="color:blue;">)(</span>,<var>next</var><span style="color:blue;">)(</span>,<var>offset</var><span style="color:blue;">)(</span>,<var>size</var><span style="color:blue;">)</span>
	<var>note</var><span style="color:blue;">(</span><var>Accidentals</var><span style="color:blue;">)</span><var>octave</var>,"<var>filename</var>",<var>mode</var><span style="color:blue;">(</span>,<var>volume</var><span style="color:blue;">)(</span>,<var>next</var><span style="color:blue;">)(</span>,<var>offset</var><span style="color:blue;">)(</span>,<var>size</var><span style="color:blue;">)</span>
</pre></code>
</div>

<!-- ──────────────── -->
<div class='block'>
<h3>引数（Inputs）</h3>

<h4>number</h4>
<p>
定義する⊿PCMの番号を0～254で指定してください。<br>
⊿PCMの発音の際は、ノートナンバーの値を参照し、その番号の⊿PCMを発音します。<br>
</p>
<table>
<tr><th>note</th><th>note number</th></tr>
<tr><td>o1c	</td><td>0		</td></tr>
<tr><td>o1c+</td><td>1			</td></tr>
<tr><td>o1d	</td><td>2		</td></tr>
<tr><td>o1d+</td><td>3			</td></tr>
<tr><td>o1e	</td><td>4		</td></tr>
<tr><td>o1f	</td><td>5		</td></tr>
<tr><td>o1f+</td><td>6			</td></tr>
<tr><td>o1g	</td><td>7		</td></tr>
<tr><td>o1g+</td><td>8			</td></tr>
<tr><td>o1a	</td><td>9		</td></tr>
<tr><td>o1a+</td><td>10			</td></tr>
<tr><td>o1b	</td><td>11		</td></tr>
<tr><td>o2c	</td><td>12		</td></tr>
<tr><td>・・・	</td><td>・・・		</td></tr>
</table>

<h4>note</h4>
<p>⊿PCMの波形を割り当てる音階を、音階で指定します。</p>
<dl>
<dt>a … </dt><dd>A, La, ラ</dd>
<dt>b … </dt><dd>H, Si, シ</dd>
<dt>c … </dt><dd>C, Do, ド</dd>
<dt>d … </dt><dd>D, Re, レ</dd>
<dt>e … </dt><dd>E, Mi, ミ</dd>
<dt>f … </dt><dd>F, Fa, ファ</dd>
<dt>g … </dt><dd>G, Sol, ソ</dd>
</dl>

<h4>Accidentals</h4>
<p>⊿PCMの波形を割り当てる音階に対する臨時記号です。省略可能です。</p>
<dl>
<dt>+ … </dt><dd>&#9839; Sharp</dd>
<dt># … </dt><dd>&#9839; Sharp</dd>
<dt>- … </dt><dd>&#9837; Flat</dd>
</dl>

<h4>octave</h4>
<p>⊿PCMの波形を割り当てるオクターブです。1～8で指定してください。</p>

<h4>filename</h4>
<p>割り当てる⊿PCMの波形ファイル（*.dmc）を指定してください。</p>

<h4>rate</h4>
<p>発音するサンプリングレートです。</p>
<table>
<tr><th>rate</th><th>clock</th><th>sample rate</th><th>scale(*)</th></tr>
<tr><td>0	</td><td>0x0D60	</td><td> 4.182 kHz</td><td>o7c	</td></tr>
<tr><td>1	</td><td>0x0BE0	</td><td> 4.711 kHz</td><td>o7d	</td></tr>
<tr><td>2	</td><td>0x0AA0	</td><td> 5.264 kHz</td><td>o7e	</td></tr>
<tr><td>3	</td><td>0x0A00	</td><td> 5.594 kHz</td><td>o7f	</td></tr>
<tr><td>4	</td><td>0x08F0	</td><td> 6.259 kHz</td><td>o7g	</td></tr>
<tr><td>5	</td><td>0x07F0	</td><td> 7.047 kHz</td><td>o7a	</td></tr>
<tr><td>6	</td><td>0x0710	</td><td> 7.920 kHz</td><td>o7b	</td></tr>
<tr><td>7	</td><td>0x06B0	</td><td> 8.364 kHz</td><td>o8c	</td></tr>
<tr><td>8	</td><td>0x05F0	</td><td> 9.421 kHz</td><td>o8d	</td></tr>
<tr><td>9	</td><td>0x0500	</td><td>11.188 kHz</td><td>o8f	</td></tr>
<tr><td>10	</td><td>0x0470	</td><td>12.606 kHz</td><td>o8g	</td></tr>
<tr><td>11	</td><td>0x0400	</td><td>13.984 kHz</td><td>o8a	</td></tr>
<tr><td>12	</td><td>0x0350	</td><td>16.877 kHz</td><td>o9c</td></tr>
<tr><td>13	</td><td>0x02A8	</td><td>21.059 kHz</td><td>o9e</td></tr>
<tr><td>14	</td><td>0x0240	</td><td>24.861 kHz</td><td>o9g</td></tr>
<tr><td>15	</td><td>0x01B0	</td><td>33.148 kHz</td><td>o10c</td></tr>
</table>
<p>(*) サンプルレート÷２の音程換算。振幅が小さい時に発生するノイズはこの音程になります。）</p>

<h4>mode</h4>
<dl>
<dt>0 … </dt><dd>1 shot</dd>
<dt>1 … </dt><dd>loop</dd>
<dt>2 … </dt><dd>IRQ （発音終了時に<var>next</var>で指定したノート番号の⊿PCMを発音します。）</dd>
</dl>

<h4>volume</h4>
<p>
⊿PCMの初期ボリュームです。<br>
0～127の範囲で指定した場合は、波形再生開始時に$4011番地に書く初期ボリュームとなります。<br>
-1を指定した場合は、波形再生開始時に$4011番地に何も書きません。<br>
省略した場合は、0となります。<br>
</p>

<h4>next</h4>
<p>
発音終了時に次にならすノート番号です。<br>
バンクに対応したbin（nsd_all.bin, nsd_all2.bin）でのみ対応しています。<br>
<var>mode</var>が2の場合は、必ず指定してください。
</p>

<h4>offset</h4>
<p>
発音開始位置を指定の分だけずらします。<br>
1で64[Byte]（512[サンプル]）ずれます。<br>
省略した場合は、0となります。
</p>

<h4>size</h4>
<p>
発音サイズを指定します。<br>
0を指定した場合はdmcファイルに合せたサイズで再生されます
（<var>offset</var>の指定がある場合、その分だけサイズを自動で小さくします）。<br>
1で16[Byte]（128[サンプル]）に相当します。<br>
省略した場合は、0となります。
</p>

</div>
<!-- ──────────────── -->
<div class='block'>
<h3>内容（Contents）</h3>

<p>
指定の各音階に、⊿PCMを割り当てます。<br>
</p>


</div>

<!-- ──────────────── -->
<div class='block'>
<h3>注意（Notes）</h3>
<p>
⊿PCMを割り当てる場合は、
#OffsetPCMコマンドにて⊿PCMの波形データの配置アドレスを設定してください。<br>
⊿PCMは、設定したアドレスから、0xFFFFのメモリ空間に配置されます。<br>
若しくは、#Bankコマンドを記述しバンクに対応したbin（nsd_all.bin, nsd_all2.bin）を使用して下さい。<br>
</p>

<p>
⊿PCMにてIRQを使用している場合、<code>&amp;</code>（スラー）ではなく、<a href="mml_tie.html"><code>^</code>（タイ）</a>を使ってください。<br>
<code>&amp;</code>（スラー）を利用して音を繋げた場合、繋げた先のノートナンバーに⊿PCMの発音中ポインタが設定され、
次のIRQではそのノートナンバーの次に示される⊿PCMが再生されます。<br>
</p>

<p>
また、多くのNSFプレイヤーは、IRQに対応しておりません。<br>
以下、2014年 1月 3日時点での対応状況です。<br>
</p>
<h4>IRQ対応プレイヤ</h4>
<ul>
<li>TNS-HFC3</li>
<li>TNS-HFC4</li>
<li>VirtuaNSF</li>
<li>VirtuaNES</li>
<li>Nintendulator</li>
<li>NEZPlug　（Version0.9.4.8+3+22.00～）</li>
<li>hoot　(2013/06/02版～)</li>
</ul>
<h4>IRQ非対応プレイヤ</h4>
<ul>
<li>NSFPlay　…（IRQそのものが実装されていません。）</li>
<li>G-NSF</li>
<li>Nestopia</li>
<li>FCEUX</li>
</ul>

</div>

<!-- ──────────────── -->
<div class='block'>
<h3>例（Sample）</h3>

<code><pre>
#OffsetPCM	$C000

DPCM{
	b1,	"../dmc/bd.dmc",14,0,64
	c2,	"../dmc/bd.dmc",15,0,64
	d2,	"../dmc/sd.dmc",15,0,64
	e2,	"../dmc/sd.dmc",14,0,64
	f+2,	"../dmc/hhc.dmc",15,0,64
	a+2,	"../dmc/hho.dmc",15,0,64
	c+3,	"../dmc/cymbal.dmc",15,0,64

	f2,	"../dmc/tom.dmc",10,0,64
	g2,	"../dmc/tom.dmc",11,0,64
	a2,	"../dmc/tom.dmc",12,0,64
	b2,	"../dmc/tom.dmc",13,0,64
	c3,	"../dmc/tom.dmc",14,0,64
	d3,	"../dmc/tom.dmc",15,0,64
}

</pre></code>

</div>

</div>

</BODY>
</HTML>
